<section id="review-scripts" class="pt-3 pb-3">
  <div class="container">
    <hr/>
    <div class="jumbotron text-white bg-primary page-header d-flex justify-content-between">
      <div class="d-flex align-items-center">
        <h4>Results for review</h4>
      </div>
    </div>
    <div *ngIf="data; then resultcontent else emptycontent"></div>
    <ng-template #resultcontent>
      <p-accordion>
        <p-accordionTab *ngFor="let item of data; let i = index">
          <p-header>
            <span [innerHTML]="item.sourceTable"></span>
            <span [innerHTML]="item.sourceTableAlias"></span>
          </p-header>
          <div class="accordion-content">
            <div *ngFor="let it of item.importTables; let j = index">
              <div class="d-flex p-2 bd-highlight">
                <div *ngIf="it.itqInstances.length > 1; then hasChild else noChild"></div>
                <ng-template #hasChild>
                  <p-tree [value]="dtInstancesTree[it.importTableName]" 
                    (onNodeExpand)="nodeExpand($event)"
                    (onNodeCollapse)="nodeCollapse($event)">
                    <ng-template let-node pTemplate="default">
                      <span class="p-2" [innerHTML]="node.label"></span>
                      <span *ngIf="node.data.isDoAction" pTooltip="Build Query" tooltipPosition="right" class="action-items p-2 fa fa-wrench" (click)="launchBuilder(i, j, node.data.instIdx)"></span>
                    </ng-template>
                  </p-tree>
                </ng-template>
                <ng-template #noChild>
                  <span class="p-2" [innerHTML]="it.importTableName"></span>
                  <span pTooltip="Build Query" tooltipPosition="right" class="action-items p-2 fa fa-wrench" (click)="launchBuilder(i, j, 0)"></span>
                </ng-template>
              </div>
            </div>
          </div>
        </p-accordionTab>
      </p-accordion>
    </ng-template>
    <ng-template #emptycontent>
      <section class="blockquote empty-content">
        <span>No results to display</span>
      </section>
    </ng-template>
  </div>
  <app-query-builder (onClose)="dialogClosed($event)" (onSave)="dialogSaved($event)"></app-query-builder>
</section>